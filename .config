# Default Error Pages
error_page 404 /error_pages 404.html;
error_page 500 502 503 504 /error_pages 50x.html;

# Limit Client Body Size Globally
client_max_body_size 100;

# Server 1
server {
    listen  5000;
    server_name localhost

    location / {
        root /server;
        index index.html;
    }

    location /subpage {
        root /server/subpage;
        index index.html;
    }

    # Route Configurations

    # 1. Route /kapouet rooted to /tmp/www
    location /kapouet {
        root /tmp/www;
        autoindex on;  # Directory listing enabled
    }

    # 2. Define Accepted HTTP Methods
    location /allowed_methods {
        limit_except GET POST {
            deny all;
        }
    }

    # 3. HTTP Redirection
    location /oldpage {
        return 301 http://example.com/newpage;
    }

    # 4. Execute CGI for .php Files
    location ~ \.php$ {
        cgi_pass unix:/run/php/php7.4-fpm.sock;  # Adjust PHP version as needed
        cgi_index index.php;
        include fastcgi_params;
        cgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        cgi_param PATH_INFO $fastcgi_script_name;
    }

    # 5. Accept Uploaded Files
    location /upload {
        root /var/www/uploads;
        client_max_body_size 5M;
        limit_except POST {
            deny all;
        }
    }
}

# Server 2
server {
    listen 8080;
    server_name test.com;

    # Root Directory
    root /var/www/test;
    index index.html index.htm default.html;

    # Directory Listing Disabled
    autoindex off;

    # Limit Client Body Size
    client_max_body_size 1M;

    # Custom Error Pages
    error_page 404 /404.html;
    location = /404.html {
        root /var/www/error_pages;
    }

    # Accept Only GET Method for /readonly
    location /readonly {
        limit_except GET {
            deny all;
        }
    }
}

# Default Server for Port 80
server {
    listen 8090 default_server;
    server_name _;

    root /var/www/default;
    index index.html index.htm;

    # Default Error Pages
    error_page 404 /404.html;
    location = /404.html {
        root /var/www/error_pages;
    }
}
